C51 COMPILER V9.54   TB6612                                                                06/24/2023 11:59:34 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE TB6612
OBJECT MODULE PLACED IN .\Objects\tb6612.obj
COMPILER INVOKED BY: D:\Software\Keil\Keil_C51\C51\BIN\C51.EXE Hardware\tb6612.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEX
                    -TEND PRINT(.\Listings\tb6612.lst) OBJECT(.\Objects\tb6612.obj)

line level    source

   1          // 2023.6.24 暂不调试不使用
   2          //http://www.51hei.com/bbs/dpj-188001-1.html
   3          #include <reg51.h>
   4          #include <intrins.h>
   5          #define uchar unsigned char
   6          #define uint unsigned int
   7          unsigned char tmp;
   8          unsigned int c=0;
   9          uint Count;
  10          uint Degree=50;
  11          sbit PWMA=P2^0;
  12          sbit AIN2=P2^1;
  13          sbit AIN1=P2^2;         
  14          sbit STBY=P2^3;
  15          sbit BIN1=P2^4;
  16          sbit BIN2=P2^5;
  17          sbit PWMB=P2^6;
  18          sbit beep=P2^7;                        //蜂鸣器
  19          void init();   //串口初始化
  20          void send(unsigned char a);        //单字节发送函数
  21          void ctrl(); //接收处理函数
  22          
  23          void delay(unsigned int x)
  24          {
  25   1              unsigned int i,j;
  26   1              for(i=x;i>0;i--)
  27   1                      for(j=110;j>0;j--);
  28   1      }
  29          
  30          void Initialize_time(void)
  31          {        
  32   1          EA=1;
  33   1          ET0=1;                                       //EA=1;ET0=1；开启总中断、定时器0
  34   1          //    TMOD=0x22;                               //M1=1,M1=0;方式2
  35   1          TH0 = 0XA3;                                   //定时时间为100us     
  36   1          TL0 = 0XA3;                                                                                          
  37   1          TR0=1;                         //启动定时器0，开始计数
  38   1      }
  39          
  40          void timer0 (void) interrupt 1            //定时中断0子程序
  41          {                                                                                                         
             -                                                                             
  42   1          Count++;        
  43   1          if(Count>=0 && Count<=Degree)
  44   1          {
  45   2              PWMA=0;
  46   2              PWMB=0;
  47   2          } else{
  48   2              PWMA=1;
  49   2              PWMB=1;
  50   2          }
  51   1          if(Count==200)        
  52   1              Count=0;                                                                                          
             -     
C51 COMPILER V9.54   TB6612                                                                06/24/2023 11:59:34 PAGE 2   

  53   1      }
  54          
  55          void init()        //串口初始化
  56          {
  57   1          ES=0;                                //关中断
  58   1          SCON = 0x50;                        // REN=1允许串行接受状态，串口工作模式1,
  59   1          //10位UART（1位起始位，8位数据位，1位停止位，无奇偶校验），波特率可
  60   1          TMOD = 0x22;                      // 定时器1工作于方式2，8位自动重载模式, 用于产生波特率
  61   1          TH1=TL1=0xFD;                   // 波特率9600 （本次测试采用晶振为11.0592）
  62   1      
  63   1          PCON &= 0x7f;                          // 波特率不倍增
  64   1          TR1 = 1;                            //定时器1开始工作，产生波特率
  65   1          //发送标志位置0
  66   1          TI=0;                               //接收标志位置0
  67   1          RI=0;
  68   1          PT1=1;
  69   1          ES=1;
  70   1      
  71   1      }
  72          
  73          void send(unsigned char a)        //单字节数据发送
  74          {                                //注意：若单片机TXD（P3.1）无上拉能力，必须在P3.1端接上拉电阻。本次测试需
             -要接上拉电阻
  75   1              TI=0;        
  76   1              SBUF=a;
  77   1              while(TI==0);
  78   1              TI=0;
  79   1      
  80   1      }
  81          
  82          void ctrl()                            //接收处理函数
  83          {
  84   1          switch(tmp)
  85   1          {
  86   2              case '1':
  87   2              {
  88   3                  AIN1=1;
  89   3                  AIN2=0;        
  90   3                  BIN1=1;
  91   3                  BIN2=0;               
  92   3                  PWMA=1;
  93   3                  PWMB=1;
  94   3                  send(tmp);
  95   3      
  96   3      
  97   3                  break;        
  98   3              }          
  99   2              
 100   2              case '8':
 101   2              {                                         
 102   3                  PWMA=0;
 103   3                  PWMB=0;
 104   3                  send(tmp);
 105   3              }
 106   2      
 107   2              break;        
 108   2      
 109   2              case '3':
 110   2              {                                         
 111   3                  AIN1=0;
 112   3                  AIN2=0;        
 113   3                  BIN1=1;
C51 COMPILER V9.54   TB6612                                                                06/24/2023 11:59:34 PAGE 3   

 114   3                  BIN2=0;               
 115   3                  PWMA=1;
 116   3                  PWMB=1;
 117   3                  send(tmp);
 118   3              }        
 119   2              break;        
 120   2              case '4':
 121   2              {                                         
 122   3                  AIN1=1;
 123   3                  AIN2=0;        
 124   3                  BIN1=0;
 125   3                  BIN2=0;               
 126   3                  PWMA=1;
 127   3                  PWMB=1;
 128   3                  send(tmp);
 129   3              }         
 130   2              break;
 131   2              
 132   2              case '5':
 133   2              {                                         
 134   3                  AIN1=0;
 135   3                  AIN2=1;        
 136   3                  BIN1=0;
 137   3                  BIN2=1;               
 138   3                  PWMA=1;
 139   3                  PWMB=1;
 140   3                  send(tmp);
 141   3              }        
 142   2              break;    
 143   2              
 144   2              case '6':
 145   2              {                                         
 146   3                  beep=0;
 147   3                  delay(50);
 148   3                  beep=1;
 149   3                  send(tmp);
 150   3              }
 151   2              break;        
 152   2              
 153   2              case '7':
 154   2              {                                         
 155   3                  Degree++;
 156   3                  if(Degree==180)
 157   3                  {
 158   4                      Degree=0;
 159   4                  }
 160   3                  send(tmp);
 161   3              }
 162   2              break;                                                        
 163   2      
 164   2          }
 165   1      }
 166          
 167          //void main()                                                   
 168          //{                 
 169          //    PWMA=1;
 170          //    PWMB=1;
 171          //    STBY=1;
 172          //    init();
 173          //    //             Initialize_time();
 174          //    while(1)
 175          //    {               
C51 COMPILER V9.54   TB6612                                                                06/24/2023 11:59:34 PAGE 4   

 176          //        if(RI==1)                     // 是否有数据到来
 177          //        {
 178          //            RI = 0;
 179          //            tmp = SBUF;                   // 暂存接收到的数据
 180          //            ctrl();
 181          //        }      
 182          //    }
 183          //}


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    270    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      7    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
