C51 COMPILER V9.54   MAIN                                                                  12/03/2022 16:49:55 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\Software\Keil_V5_C51\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\App) DEBUG OBJECTE
                    -XTEND PRINT(.\Listings\main.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <REGX52.H>
   2          #include "AT24C02.h"
   3          #include "ds1302.h"
   4          #include "Delay.h"
   5          #include "DS18B20.h"
   6          #include "Key.h"
   7          #include "LCD1602.h"
   8          #include "Timer0.h"
   9          
  10          
  11          /*********************
  12           * Func.: 
  13           * Author:江科大自化协
  14           * Date:
  15           *********************/
  16          void main()
  17          {
  18   1              LCD_Init();
  19   1              DS1302_Init();
  20   1              LCD_ShowString(1,1,"  -  -  ");//静态字符初始化显示
  21   1              LCD_ShowString(2,1,"  :  :  ");
  22   1              
  23   1              DS1302_SetTime();//设置时间
  24   1              
  25   1              while(1)
  26   1              {
  27   2                      DS1302_ReadTime();//读取时间
  28   2                      LCD_ShowNum(1,1,DS1302_Time[0],2);//显示年
  29   2                      LCD_ShowNum(1,4,DS1302_Time[1],2);//显示月
  30   2                      LCD_ShowNum(1,7,DS1302_Time[2],2);//显示日
  31   2                      LCD_ShowNum(2,1,DS1302_Time[3],2);//显示时
  32   2                      LCD_ShowNum(2,4,DS1302_Time[4],2);//显示分
  33   2                      LCD_ShowNum(2,7,DS1302_Time[5],2);//显示秒
  34   2              }
  35   1      }
  36          
  37          
  38          
  39          float T,TShow;
  40          char TLow,THigh;
  41          unsigned char KeyNum;
  42          
  43          //K1按键，THigh自增
  44          //K2按键，THigh自减
  45          //K3按键，TLow自增
  46          //K4按键，TLow自减
  47          /*********************
  48           * Func.: 
  49           * Author:江科大自化协
  50           * Date:
  51           *********************/
  52          void main1()
  53          {
  54   1          // 初始化-bgn
C51 COMPILER V9.54   MAIN                                                                  12/03/2022 16:49:55 PAGE 2   

  55   1              DS18B20_ConvertT();             //上电先转换一次温度，防止第一次读数据错误
  56   1              Delay(1000);                    //等待转换完成
  57   1              THigh=AT24C02_ReadByte(0);      //读取温度阈值数据
  58   1              TLow=AT24C02_ReadByte(1);
  59   1              if(THigh>125 || TLow<-55 || THigh<=TLow)
  60   1              {
  61   2                      THigh=20;                       //如果阈值非法，则设为默认值
  62   2                      TLow=15;
  63   2              }
  64   1              LCD_Init();
  65   1              LCD_ShowString(1,1,"T:");
  66   1              LCD_ShowString(2,1,"TH:");
  67   1              LCD_ShowString(2,9,"TL:");
  68   1              LCD_ShowSignedNum(2,4,THigh,3);
  69   1              LCD_ShowSignedNum(2,12,TLow,3);
  70   1              Timer0_Init();
  71   1              // 初始化-end
  72   1          
  73   1              while(1)
  74   1              {
  75   2                      KeyNum=Key();
  76   2                      
  77   2                      /*温度读取及显示*/
  78   2                      DS18B20_ConvertT();     //转换温度
  79   2                      T=DS18B20_ReadT();      //读取温度
  80   2                      if(T<0)                         //如果温度小于0
  81   2                      {
  82   3                              LCD_ShowChar(1,3,'-');  //显示负号
  83   3                              TShow=-T;               //将温度变为正数
  84   3                      }
  85   2                      else                            //如果温度大于等于0
  86   2                      {
  87   3                              LCD_ShowChar(1,3,'+');  //显示正号
  88   3                              TShow=T;
  89   3                      }
  90   2                      LCD_ShowNum(1,4,TShow,3);               //显示温度整数部分
  91   2                      LCD_ShowChar(1,7,'.');          //显示小数点
  92   2                      LCD_ShowNum(1,8,(unsigned long)(TShow*100)%100,2);//显示温度小数部分
  93   2                      
  94   2                      /*阈值判断及显示*/
  95   2                      if(KeyNum)
  96   2                      {
  97   3                              if(KeyNum==1)   //K1按键，THigh自增
  98   3                              {
  99   4                                      THigh++;
 100   4                                      if(THigh>125){THigh=125;}
 101   4                              }
 102   3                              if(KeyNum==2)   //K2按键，THigh自减
 103   3                              {
 104   4                                      THigh--;
 105   4                                      if(THigh<=TLow){THigh++;}
 106   4                              }
 107   3                              if(KeyNum==3)   //K3按键，TLow自增
 108   3                              {
 109   4                                      TLow++;
 110   4                                      if(TLow>=THigh){TLow--;}
 111   4                              }
 112   3                              if(KeyNum==4)   //K4按键，TLow自减
 113   3                              {
 114   4                                      TLow--;
 115   4                                      if(TLow<-55){TLow=-55;}
 116   4                              }
C51 COMPILER V9.54   MAIN                                                                  12/03/2022 16:49:55 PAGE 3   

 117   3                              LCD_ShowSignedNum(2,4,THigh,3); //显示阈值数据
 118   3                              LCD_ShowSignedNum(2,12,TLow,3);
 119   3                              AT24C02_WriteByte(0,THigh);             //写入到At24C02中保存
 120   3                              Delay(5);
 121   3                              AT24C02_WriteByte(1,TLow);
 122   3                              Delay(5);
 123   3                      }
 124   2              //越界判断
 125   2                      if (T>THigh) {
 126   3                              LCD_ShowString(1,13,"OV:H");
 127   3                      } else if(T<TLow) {
 128   3                              LCD_ShowString(1,13,"OV:L");
 129   3                      } else {
 130   3                              LCD_ShowString(1,13,"    ");
 131   3                      }
 132   2              }
 133   1      }
 134          
 135          /*********************
 136           * Func.: 按键扫描中断
 137           * Author:江科大自化协
 138           * Date:
 139           *********************/
 140          void Timer0_Routine() interrupt 1
 141          {
 142   1              static unsigned int T0Count;
 143   1              TL0 = 0x18;             //设置定时初值
 144   1              TH0 = 0xFC;             //设置定时初值
 145   1              T0Count++;
 146   1              if(T0Count>=20)
 147   1              {
 148   2                      T0Count=0;
 149   2                      Key_Loop();     //每20ms调用一次按键驱动函数
 150   2              }
 151   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    759    ----
   CONSTANT SIZE    =     44    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     13    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
